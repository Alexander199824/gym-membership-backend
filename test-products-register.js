// test-products-register.js - REGISTRADOR COMPLETO DE PRODUCTOS v1.0 (DESDE CERO)
const axios = require('axios');
const FormData = require('form-data');
const fs = require('fs');
const path = require('path');

class ProductsRegister {
  constructor(baseURL = 'http://localhost:5000') {
    this.baseURL = baseURL;
    this.adminToken = null;
    
    // Datos de productos a registrar
    this.productsData = [
      {
        name: 'Nitro Tech Whey Protein',
        description: 'Prote√≠na de suero de leche premium con tecnolog√≠a de aislamiento avanzada. Ideal para el desarrollo muscular y recuperaci√≥n post-entrenamiento. Sabor chocolate.',
        price: 89.99,
        comparePrice: 109.99,
        sku: 'NT-WHEY-CHOC-2LB',
        stockQuantity: 25,
        minStock: 5,
        weight: 2.0,
        dimensions: '15x15x20',
        isFeatured: true,
        isActive: true,
        tags: ['prote√≠na', 'suplemento', 'm√∫sculo', 'recuperaci√≥n'],
        variants: {
          sabor: ['Chocolate', 'Vainilla', 'Fresa'],
          tama√±o: ['2 lbs', '4 lbs', '8 lbs']
        },
        nutritionalInfo: {
          porcion: '30g',
          proteina: '24g',
          carbohidratos: '3g',
          grasas: '1g',
          calorias: '120'
        },
        categoryName: 'Suplementos',
        brandName: 'Universal Nutrition',
        imagePath: 'C:\\Users\\echev\\OneDrive\\Escritorio\\productos de prueba\\suplementos-universalfitness.png'
      },
      {
        name: 'Conjunto Deportivo Hombre Premium',
        description: 'Conjunto deportivo de alta calidad para hombre, incluye camiseta y pantal√≥n. Material transpirable y de secado r√°pido. Perfecto para entrenamientos intensos y uso casual.',
        price: 45.99,
        comparePrice: 65.99,
        sku: 'CD-HOMBRE-PREM-L',
        stockQuantity: 15,
        minStock: 3,
        weight: 0.8,
        dimensions: '30x25x5',
        isFeatured: true,
        isActive: true,
        tags: ['ropa', 'conjunto', 'deportivo', 'hombre', 'entrenamiento'],
        variants: {
          talla: ['S', 'M', 'L', 'XL', 'XXL'],
          color: ['Negro', 'Gris', 'Azul Marino']
        },
        materialInfo: {
          composicion: '90% Poli√©ster, 10% Elastano',
          cuidado: 'Lavar en m√°quina m√°x 30¬∞C',
          origen: 'China'
        },
        categoryName: 'Ropa Deportiva',
        brandName: 'Nike',
        imagePath: 'C:\\Users\\echev\\OneDrive\\Escritorio\\productos de prueba\\51NhX5fdSEL.jpg'
      }
    ];
    
    // Control de registro
    this.registeredCategories = [];
    this.registeredBrands = [];
    this.registeredProducts = [];
    this.uploadedImages = [];
  }

  async registerAllProducts() {
    console.log('üè™ REGISTRADOR COMPLETO DE PRODUCTOS - DESDE CERO v1.0');
    console.log('='.repeat(80));
    console.log('üéØ OBJETIVO: Crear productos completos con categor√≠as, marcas e im√°genes');
    console.log('üì¶ PRODUCTOS A REGISTRAR: 2 productos (Suplemento + Ropa deportiva)');
    console.log('üîÑ PROCESO COMPLETO: Categor√≠as ‚Üí Marcas ‚Üí Productos ‚Üí Im√°genes\n');
    
    try {
      await this.loginAdmin();
      await this.showExistingData();
      await this.createCategories();
      await this.createBrands();
      await this.createProducts();
      await this.uploadProductImages();
      await this.showFinalSummary();
      
      console.log('\nüéâ ¬°REGISTRO DE PRODUCTOS COMPLETADO EXITOSAMENTE!');
      console.log('‚úÖ Todos los productos est√°n listos para la venta');
      console.log('üõí Los clientes ya pueden ver y comprar estos productos');
      
    } catch (error) {
      console.error('\n‚ùå Error en el registro:', error.message);
      if (error.response) {
        console.error('üìã Detalles del error:', error.response.data);
      }
      await this.showCleanupInstructions();
    }
  }

  async loginAdmin() {
    console.log('1. üîê Autenticando como administrador...');
    
    try {
      const response = await axios.post(`${this.baseURL}/api/auth/login`, {
        email: 'admin@gym.com',
        password: 'Admin123!'
      });

      if (response.data.success && response.data.data.token) {
        this.adminToken = response.data.data.token;
        console.log('   ‚úÖ Autenticaci√≥n exitosa');
        console.log(`   üë§ Usuario: ${response.data.data.user.firstName} ${response.data.data.user.lastName}`);
        console.log(`   üé≠ Rol: ${response.data.data.user.role}`);
      }
    } catch (error) {
      throw new Error(`Autenticaci√≥n fall√≥: ${error.message}`);
    }
  }

  async showExistingData() {
    console.log('\n2. üìä Verificando datos existentes en la tienda...');
    
    try {
      // Obtener categor√≠as existentes
      const categoriesResponse = await axios.get(`${this.baseURL}/api/store/categories`);
      const existingCategories = categoriesResponse.data.success ? categoriesResponse.data.data.categories : [];
      
      // Obtener marcas existentes
      const brandsResponse = await axios.get(`${this.baseURL}/api/store/brands`);
      const existingBrands = brandsResponse.data.success ? brandsResponse.data.data.brands : [];
      
      // Obtener productos existentes
      const productsResponse = await axios.get(`${this.baseURL}/api/store/products`, {
        params: { limit: 100 }
      });
      const existingProducts = productsResponse.data.success ? productsResponse.data.data.products : [];
      
      console.log('   üìä DATOS ACTUALES DE LA TIENDA:');
      console.log(`   üìÇ Categor√≠as: ${existingCategories.length} registradas`);
      console.log(`   üè∑Ô∏è  Marcas: ${existingBrands.length} registradas`);
      console.log(`   üì¶ Productos: ${existingProducts.length} registrados`);
      
      if (existingCategories.length > 0) {
        console.log(`   üìÇ Categor√≠as existentes: ${existingCategories.map(c => c.name).join(', ')}`);
      }
      
      if (existingBrands.length > 0) {
        console.log(`   üè∑Ô∏è  Marcas existentes: ${existingBrands.map(b => b.name).join(', ')}`);
      }
      
      console.log('   ‚úÖ Verificaci√≥n completada');
      
    } catch (error) {
      console.log('   ‚ö†Ô∏è No se pudieron obtener datos existentes, continuando...');
    }
  }

  async createCategories() {
    console.log('\n3. üìÇ Creando/Verificando categor√≠as necesarias...');
    
    const categoriesToCreate = [
      {
        name: 'Suplementos',
        description: 'Suplementos deportivos, prote√≠nas, vitaminas y nutrici√≥n deportiva',
        slug: 'suplementos',
        isActive: true,
        displayOrder: 1,
        metaTitle: 'Suplementos Deportivos - Elite Fitness Club',
        metaDescription: 'Los mejores suplementos deportivos para tu entrenamiento'
      },
      {
        name: 'Ropa Deportiva',
        description: 'Ropa y vestimenta para entrenamientos, casual wear deportivo',
        slug: 'ropa-deportiva',
        isActive: true,
        displayOrder: 2,
        metaTitle: 'Ropa Deportiva - Elite Fitness Club',
        metaDescription: 'Ropa deportiva de calidad para hombres y mujeres'
      }
    ];

    for (const categoryData of categoriesToCreate) {
      try {
        console.log(`\n   üìÇ Creando categor√≠a: "${categoryData.name}"`);
        
        const response = await axios.post(`${this.baseURL}/api/admin/store/categories`, categoryData, {
          headers: { 'Authorization': `Bearer ${this.adminToken}` }
        });
        
        if (response.data.success) {
          this.registeredCategories.push(response.data.data.category);
          console.log(`   ‚úÖ Categor√≠a "${categoryData.name}" creada exitosamente`);
          console.log(`   üÜî ID: ${response.data.data.category.id}`);
          console.log(`   üîó Slug: ${response.data.data.category.slug}`);
        }
        
      } catch (error) {
        if (error.response?.status === 400 && error.response.data.message?.includes('ya existe')) {
          console.log(`   ‚ö†Ô∏è Categor√≠a "${categoryData.name}" ya existe, obteniendo datos...`);
          
          try {
            const existingResponse = await axios.get(`${this.baseURL}/api/store/categories`);
            const existingCategory = existingResponse.data.data.categories.find(c => c.name === categoryData.name);
            if (existingCategory) {
              this.registeredCategories.push(existingCategory);
              console.log(`   ‚úÖ Usando categor√≠a existente: ${existingCategory.id}`);
            }
          } catch (getError) {
            console.log(`   ‚ùå No se pudo obtener la categor√≠a existente`);
          }
        } else {
          console.error(`   ‚ùå Error creando categor√≠a "${categoryData.name}": ${error.response?.data?.message || error.message}`);
        }
      }
    }
    
    console.log(`\n   üéØ CATEGOR√çAS DISPONIBLES: ${this.registeredCategories.length} listas para usar`);
  }

  async createBrands() {
    console.log('\n4. üè∑Ô∏è Creando/Verificando marcas necesarias...');
    
    const brandsToCreate = [
      {
        name: 'Universal Nutrition',
        description: 'L√≠der mundial en suplementos deportivos y nutrici√≥n',
        website: 'https://www.universalnutrition.com',
        country: 'USA',
        isActive: true,
        displayOrder: 1
      },
      {
        name: 'Nike',
        description: 'Marca l√≠der mundial en ropa y calzado deportivo',
        website: 'https://www.nike.com',
        country: 'USA',
        isActive: true,
        displayOrder: 2
      }
    ];

    for (const brandData of brandsToCreate) {
      try {
        console.log(`\n   üè∑Ô∏è Creando marca: "${brandData.name}"`);
        
        const response = await axios.post(`${this.baseURL}/api/admin/store/brands`, brandData, {
          headers: { 'Authorization': `Bearer ${this.adminToken}` }
        });
        
        if (response.data.success) {
          this.registeredBrands.push(response.data.data.brand);
          console.log(`   ‚úÖ Marca "${brandData.name}" creada exitosamente`);
          console.log(`   üÜî ID: ${response.data.data.brand.id}`);
          console.log(`   üåê Website: ${response.data.data.brand.website}`);
        }
        
      } catch (error) {
        if (error.response?.status === 400 && error.response.data.message?.includes('ya existe')) {
          console.log(`   ‚ö†Ô∏è Marca "${brandData.name}" ya existe, obteniendo datos...`);
          
          try {
            const existingResponse = await axios.get(`${this.baseURL}/api/store/brands`);
            const existingBrand = existingResponse.data.data.brands.find(b => b.name === brandData.name);
            if (existingBrand) {
              this.registeredBrands.push(existingBrand);
              console.log(`   ‚úÖ Usando marca existente: ${existingBrand.id}`);
            }
          } catch (getError) {
            console.log(`   ‚ùå No se pudo obtener la marca existente`);
          }
        } else {
          console.error(`   ‚ùå Error creando marca "${brandData.name}": ${error.response?.data?.message || error.message}`);
        }
      }
    }
    
    console.log(`\n   üéØ MARCAS DISPONIBLES: ${this.registeredBrands.length} listas para usar`);
  }

  async createProducts() {
    console.log('\n5. üì¶ Creando productos completos...');
    
    for (let i = 0; i < this.productsData.length; i++) {
      const productData = this.productsData[i];
      console.log(`\n   üì¶ CREANDO PRODUCTO ${i + 1}/${this.productsData.length}: "${productData.name}"`);
      console.log('   ' + '-'.repeat(60));
      
      try {
        // Buscar la categor√≠a y marca correspondientes
        const category = this.registeredCategories.find(c => c.name === productData.categoryName);
        const brand = this.registeredBrands.find(b => b.name === productData.brandName);
        
        if (!category) {
          throw new Error(`Categor√≠a "${productData.categoryName}" no encontrada`);
        }
        
        if (!brand) {
          throw new Error(`Marca "${productData.brandName}" no encontrada`);
        }
        
        // Preparar datos del producto
        const productPayload = {
          name: productData.name,
          description: productData.description,
          price: productData.price,
          comparePrice: productData.comparePrice,
          sku: productData.sku,
          stockQuantity: productData.stockQuantity,
          minStock: productData.minStock,
          weight: productData.weight,
          dimensions: productData.dimensions,
          categoryId: category.id,
          brandId: brand.id,
          isFeatured: productData.isFeatured,
          isActive: productData.isActive,
          tags: productData.tags,
          variants: productData.variants,
          nutritionalInfo: productData.nutritionalInfo,
          materialInfo: productData.materialInfo
        };
        
        console.log(`   üìä Datos del producto preparados:`);
        console.log(`      üí∞ Precio: $${productPayload.price} (compare: $${productPayload.comparePrice})`);
        console.log(`      üì¶ Stock: ${productPayload.stockQuantity} unidades`);
        console.log(`      üìÇ Categor√≠a: ${category.name} (ID: ${category.id})`);
        console.log(`      üè∑Ô∏è Marca: ${brand.name} (ID: ${brand.id})`);
        console.log(`      üè∑Ô∏è SKU: ${productPayload.sku}`);
        console.log(`      ‚≠ê Destacado: ${productPayload.isFeatured ? 'S√≠' : 'No'}`);
        
        // Crear el producto
        const response = await axios.post(`${this.baseURL}/api/admin/store/products`, productPayload, {
          headers: { 
            'Authorization': `Bearer ${this.adminToken}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.data.success) {
          this.registeredProducts.push({
            ...response.data.data.product,
            imagePath: productData.imagePath
          });
          
          console.log(`   ‚úÖ PRODUCTO CREADO EXITOSAMENTE`);
          console.log(`      üÜî ID del producto: ${response.data.data.product.id}`);
          console.log(`      üì¶ Nombre: ${response.data.data.product.name}`);
          console.log(`      üí∞ Precio: $${response.data.data.product.price}`);
          console.log(`      üìä Stock inicial: ${response.data.data.product.stockQuantity}`);
        }
        
      } catch (error) {
        console.error(`   ‚ùå Error creando producto "${productData.name}":`);
        console.error(`      üí• ${error.response?.data?.message || error.message}`);
        
        if (error.response?.data?.errors) {
          console.error('      üìã Errores de validaci√≥n:');
          Object.entries(error.response.data.errors).forEach(([field, message]) => {
            console.error(`         ‚Ä¢ ${field}: ${message}`);
          });
        }
      }
    }
    
    console.log(`\n   üéØ PRODUCTOS REGISTRADOS: ${this.registeredProducts.length} de ${this.productsData.length} completados`);
  }

  async uploadProductImages() {
    console.log('\n6. üñºÔ∏è Subiendo im√°genes de productos...');
    
    if (this.registeredProducts.length === 0) {
      console.log('   ‚ö†Ô∏è No hay productos registrados para subir im√°genes');
      return;
    }
    
    for (let i = 0; i < this.registeredProducts.length; i++) {
      const product = this.registeredProducts[i];
      console.log(`\n   üñºÔ∏è SUBIENDO IMAGEN ${i + 1}/${this.registeredProducts.length}: "${product.name}"`);
      console.log('   ' + '-'.repeat(50));
      
      try {
        const imagePath = product.imagePath;
        console.log(`   üìÅ Ruta de imagen: ${imagePath}`);
        
        // Verificar que el archivo existe
        if (!fs.existsSync(imagePath)) {
          throw new Error(`Archivo de imagen no encontrado: ${imagePath}`);
        }
        
        const stats = fs.statSync(imagePath);
        console.log(`   üìè Tama√±o del archivo: ${(stats.size / 1024 / 1024).toFixed(2)} MB`);
        
        // Crear FormData para subir la imagen
        const formData = new FormData();
        formData.append('image', fs.createReadStream(imagePath));
        formData.append('productId', product.id);
        formData.append('isPrimary', 'true');
        formData.append('displayOrder', '1');
        formData.append('altText', `${product.name} - Imagen principal`);
        
        console.log(`   üì§ Subiendo imagen para producto ID: ${product.id}...`);
        
        const response = await axios.post(
          `${this.baseURL}/api/admin/store/products/${product.id}/images`, 
          formData,
          {
            headers: { 
              'Authorization': `Bearer ${this.adminToken}`,
              ...formData.getHeaders()
            },
            maxContentLength: Infinity,
            maxBodyLength: Infinity
          }
        );
        
        if (response.data.success) {
          this.uploadedImages.push(response.data.data.image);
          console.log(`   ‚úÖ IMAGEN SUBIDA EXITOSAMENTE`);
          console.log(`      üÜî ID de imagen: ${response.data.data.image.id}`);
          console.log(`      üîó URL: ${response.data.data.image.imageUrl}`);
          console.log(`      ‚≠ê Imagen principal: ${response.data.data.image.isPrimary ? 'S√≠' : 'No'}`);
        }
        
      } catch (error) {
        console.error(`   ‚ùå Error subiendo imagen para "${product.name}":`);
        console.error(`      üí• ${error.response?.data?.message || error.message}`);
        
        if (error.code === 'ENOENT') {
          console.error('      üìÅ Verifica que la ruta del archivo sea correcta');
        } else if (error.response?.status === 413) {
          console.error('      üìè El archivo es demasiado grande');
        }
      }
    }
    
    console.log(`\n   üéØ IM√ÅGENES SUBIDAS: ${this.uploadedImages.length} de ${this.registeredProducts.length} completadas`);
  }

  async showFinalSummary() {
    console.log('\n7. üìä RESUMEN FINAL DEL REGISTRO');
    console.log('=' .repeat(60));
    
    // Resumen general
    console.log('üéØ RESUMEN DE REGISTRO COMPLETADO:');
    console.log(`   üìÇ Categor√≠as: ${this.registeredCategories.length} preparadas`);
    console.log(`   üè∑Ô∏è Marcas: ${this.registeredBrands.length} preparadas`);
    console.log(`   üì¶ Productos: ${this.registeredProducts.length} creados`);
    console.log(`   üñºÔ∏è Im√°genes: ${this.uploadedImages.length} subidas`);
    
    // Detalles de categor√≠as
    if (this.registeredCategories.length > 0) {
      console.log('\nüìÇ CATEGOR√çAS REGISTRADAS:');
      this.registeredCategories.forEach((category, index) => {
        console.log(`   ${index + 1}. ${category.name} (ID: ${category.id})`);
        console.log(`      üîó Slug: ${category.slug}`);
      });
    }
    
    // Detalles de marcas
    if (this.registeredBrands.length > 0) {
      console.log('\nüè∑Ô∏è MARCAS REGISTRADAS:');
      this.registeredBrands.forEach((brand, index) => {
        console.log(`   ${index + 1}. ${brand.name} (ID: ${brand.id})`);
        if (brand.website) {
          console.log(`      üåê Website: ${brand.website}`);
        }
      });
    }
    
    // Detalles de productos
    if (this.registeredProducts.length > 0) {
      console.log('\nüì¶ PRODUCTOS REGISTRADOS:');
      this.registeredProducts.forEach((product, index) => {
        const hasImage = this.uploadedImages.some(img => img.productId === product.id);
        
        console.log(`\n   ${index + 1}. "${product.name}"`);
        console.log(`      üÜî ID: ${product.id}`);
        console.log(`      üí∞ Precio: $${product.price} ${product.comparePrice ? `(antes: $${product.comparePrice})` : ''}`);
        console.log(`      üì¶ Stock: ${product.stockQuantity} unidades`);
        console.log(`      üè∑Ô∏è SKU: ${product.sku}`);
        console.log(`      ‚≠ê Destacado: ${product.isFeatured ? 'S√≠' : 'No'}`);
        console.log(`      üñºÔ∏è Imagen: ${hasImage ? '‚úÖ Subida' : '‚ùå Sin imagen'}`);
        
        // Mostrar imagen si existe
        const productImage = this.uploadedImages.find(img => img.productId === product.id);
        if (productImage) {
          console.log(`         üîó URL: ${productImage.imageUrl}`);
        }
      });
    }
    
    // C√°lculos financieros
    if (this.registeredProducts.length > 0) {
      const totalValue = this.registeredProducts.reduce((sum, product) => 
        sum + (parseFloat(product.price) * product.stockQuantity), 0
      );
      const totalStock = this.registeredProducts.reduce((sum, product) => 
        sum + product.stockQuantity, 0
      );
      
      console.log('\nüí∞ VALOR TOTAL DEL INVENTARIO REGISTRADO:');
      console.log(`   üì¶ Total de unidades: ${totalStock}`);
      console.log(`   üí∞ Valor total: $${totalValue.toFixed(2)}`);
      console.log(`   üìä Precio promedio: $${(totalValue / totalStock).toFixed(2)} por unidad`);
    }
    
    // URLs de acceso
    console.log('\nüåê ACCESO A LOS PRODUCTOS:');
    console.log(`   üõí Tienda: ${this.baseURL}/store`);
    console.log(`   üì± API Productos: ${this.baseURL}/api/store/products`);
    console.log(`   ‚≠ê Destacados: ${this.baseURL}/api/store/products/featured`);
    
    // Estado final
    console.log('\n‚úÖ ESTADO FINAL:');
    if (this.registeredProducts.length === this.productsData.length) {
      console.log('   üéâ ¬°TODOS LOS PRODUCTOS REGISTRADOS EXITOSAMENTE!');
      console.log('   ‚úÖ Los productos ya est√°n disponibles para la venta');
      console.log('   üõí Los clientes pueden ver y comprar estos productos');
      
      if (this.uploadedImages.length === this.registeredProducts.length) {
        console.log('   üñºÔ∏è ‚úÖ Todas las im√°genes subidas correctamente');
      } else {
        console.log('   üñºÔ∏è ‚ö†Ô∏è Algunas im√°genes no se subieron');
      }
    } else {
      console.log('   ‚ö†Ô∏è No todos los productos se registraron correctamente');
      console.log('   üìã Revisa los errores anteriores para m√°s detalles');
    }
  }

  async showCleanupInstructions() {
    console.log('\nüßπ INSTRUCCIONES DE LIMPIEZA (EN CASO DE ERROR)');
    console.log('=' .repeat(60));
    
    if (this.registeredProducts.length > 0) {
      console.log('üì¶ PRODUCTOS CREADOS (para eliminar si es necesario):');
      this.registeredProducts.forEach(product => {
        console.log(`   ‚Ä¢ ID: ${product.id} - "${product.name}"`);
      });
    }
    
    if (this.registeredCategories.length > 0) {
      console.log('\nüìÇ CATEGOR√çAS CREADAS:');
      this.registeredCategories.forEach(category => {
        console.log(`   ‚Ä¢ ID: ${category.id} - "${category.name}"`);
      });
    }
    
    if (this.registeredBrands.length > 0) {
      console.log('\nüè∑Ô∏è MARCAS CREADAS:');
      this.registeredBrands.forEach(brand => {
        console.log(`   ‚Ä¢ ID: ${brand.id} - "${brand.name}"`);
      });
    }
    
    console.log('\nüí° Para limpiar datos de prueba:');
    console.log('   1. Elimina productos desde el panel de admin');
    console.log('   2. Elimina categor√≠as no utilizadas');
    console.log('   3. Elimina marcas no utilizadas');
  }
}

// ‚úÖ FUNCI√ìN DE AYUDA
function showHelp() {
  console.log('\nüè™ Elite Fitness Club - Registrador de Productos v1.0\n');
  console.log('üéØ REGISTRO COMPLETO DE PRODUCTOS:');
  console.log('  üìÇ Crea categor√≠as necesarias (Suplementos, Ropa Deportiva)');
  console.log('  üè∑Ô∏è Crea marcas necesarias (Universal Nutrition, Nike)');
  console.log('  üì¶ Registra productos completos con todos sus datos');
  console.log('  üñºÔ∏è Sube im√°genes reales de los productos');
  console.log('  üìä Genera inventario listo para la venta\n');
  
  console.log('‚ú® PRODUCTOS A REGISTRAR:');
  console.log('  ü•§ Nitro Tech Whey Protein (Suplemento)');
  console.log('     ‚Ä¢ Precio: $89.99, Stock: 25 unidades');
  console.log('     ‚Ä¢ Imagen: suplementos-universalfitness.png');
  console.log('  üëï Conjunto Deportivo Hombre (Ropa)');
  console.log('     ‚Ä¢ Precio: $45.99, Stock: 15 unidades');
  console.log('     ‚Ä¢ Imagen: 51NhX5fdSEL.jpg\n');
  
  console.log('üöÄ USO:');
  console.log('  node test-products-register.js        # Registrar productos');
  console.log('  node test-products-register.js --help # Mostrar esta ayuda\n');
  
  console.log('üìã REQUISITOS:');
  console.log('  ‚Ä¢ Servidor backend ejecut√°ndose (npm start)');
  console.log('  ‚Ä¢ Usuario admin creado (admin@gym.com)');
  console.log('  ‚Ä¢ Im√°genes en las rutas especificadas');
  console.log('  ‚Ä¢ Endpoints de admin configurados\n');
}

// ‚úÖ FUNCI√ìN PRINCIPAL
async function main() {
  const args = process.argv.slice(2);
  
  if (args.includes('--help') || args.includes('-h')) {
    showHelp();
    return;
  }
  
  const register = new ProductsRegister();
  
  try {
    await register.registerAllProducts();
    
  } catch (error) {
    console.error('\nüö® ERROR EN EL REGISTRO:');
    console.error(`‚ùå ${error.message}\n`);
    
    console.error('üí° POSIBLES SOLUCIONES:');
    
    if (error.message.includes('ECONNREFUSED') || error.message.includes('Network Error')) {
      console.error('   1. ‚úÖ Verifica que tu servidor est√© ejecut√°ndose: npm start');
      console.error('   2. ‚úÖ Verifica que el puerto sea el correcto (5000)');
    } else if (error.message.includes('Autenticaci√≥n fall√≥')) {
      console.error('   1. ‚úÖ Verifica que el usuario admin existe: admin@gym.com');
      console.error('   2. ‚úÖ Verifica la contrase√±a: Admin123!');
    } else if (error.message.includes('404') || error.message.includes('endpoint')) {
      console.error('   1. ‚úÖ Verifica que las rutas de admin est√©n configuradas');
      console.error('   2. ‚úÖ Verifica que el middleware requireStaff funcione');
    } else if (error.message.includes('archivo no encontrado')) {
      console.error('   1. ‚úÖ Verifica las rutas de las im√°genes');
      console.error('   2. ‚úÖ Aseg√∫rate de que los archivos existan');
    }
    
    process.exit(1);
  }
}

// ‚úÖ EJECUTAR SI SE LLAMA DIRECTAMENTE
if (require.main === module) {
  main();
}

module.exports = { ProductsRegister };